{% extends "base.html" %}

{% load i18n %}
{% load static %}

{% load iasp_tags %}


{% block top_buttons %}
<a href="{% url 'generics:home' %}" class="btn btn-outline-secondary">
    <svg class="icon icon-sm">
        <use href="{% static 'svg/sprites.svg' %}#it-arrow-left"></use>
    </svg> {% trans "Home" %}
</a>
<a href="{% url 'applications:applications' %}" class="btn btn-outline-secondary ms-md-1">
    <svg class="icon icon-sm">
        <use href="{% static 'svg/sprites.svg' %}#it-folder"></use>
    </svg> {% trans "My applications" %}
</a>
<a href="{% url 'applications:application' application_pk=application.pk %}" class="btn btn-outline-secondary ms-md-1">
    <svg class="icon icon-sm">
        <use href="{% static 'svg/sprites.svg' %}#it-note"></use>
    </svg> {% trans "Back to application" %}
</a>
<a href="{% url 'applications:application_required_list' application_pk=application.pk %}" class="btn btn-outline-secondary ms-md-1">
    <svg class="icon icon-sm">
        <use href="{% static 'svg/sprites.svg' %}#it-list"></use>
    </svg> {% trans "Required teachings" %}
</a>
{% endblock top_buttons %}

{% block clean_content %}
{% get_current_language as LANGUAGE_CODE %}
<div class="mb-4">
    <p class="h3">
        {% trans "Credits recognition requests" %}
    </p>
    <p class="h5">
        {{ target_teaching.name }}
        <br>
        {% trans "Credits" %}: {{ target_teaching.credits|floatformat:1 }}
    </p>
</div>

<p>
    {% if LANGUAGE_CODE == 'it' %}
        {{ call.title_it }}
    {% else %}
        {{ call.title_en }}
    {% endif %}
</p>

{% if insertions %}
<div class="table-responsive">
    <table class="table table-striped table-hover table-bordered">
        <thead>
          <tr>
            <th scope="col">{% trans "Code" %}</th>
            <th scope="col">{% trans "Name" %}</th>
            <th scope="col" class="text-end">{% trans "SSD" %}</th>
            <th scope="col" class="text-end">{% trans "Credits" %}</th>
            <th scope="col" class="text-end">{% trans "Teaching program" %}</th>
            <th scope="col"></th>
          </tr>
        </thead>
        <tbody>
            {% for insertion in insertions %}
            <tr>
                <td>{{ insertion.source_teaching_cod }}</td>
                <td>{{ insertion.source_teaching_name }}</td>
                <td class="text-end">{{ insertion.source_teaching_ssd|default:'-' }}</td>
                <td class="text-end">{{ insertion.source_teaching_credits }}</td>
                <td class="text-end">
                    <a href="{% url 'applications:download_insertion_attachment' application_pk=application.pk insertion_pk=insertion.pk %}" target="_blank" title="{% trans 'Click here' %}">
                        {% trans "Download" %}
                    </a>
                </td>
                <td class="text-end">
                    {% if structure %}
                    <a href="{% url 'management:application_required_detail' structure_code=structure.unique_code call_pk=call.pk application_pk=application.pk teaching_id=target_teaching.id insertion_pk=insertion.pk %}" class="btn btn-info btn-xs">
                    {% else %}
                    <a href="{% url 'applications:application_required_edit' application_pk=application.pk teaching_id=target_teaching.id insertion_pk=insertion.pk %}" class="btn btn-info btn-xs">
                    {% endif %}
                        <svg class="icon icon-xs icon-white">
                            {% if application.is_editable %}
                            <use xlink:href="{% static 'svg/sprites.svg' %}#it-pencil"></use>
                            {% else %}
                            <use xlink:href="{% static 'svg/sprites.svg' %}#it-password-visible"></use>
                            {% endif %}
                        </svg>
                    </a>
                    {% if application.is_editable %}
                    <button type="button" class="btn btn-outline-danger btn-xs" data-bs-toggle="modal" data-bs-target="#delete">
                        <svg class="icon icon-xs icon-danger">
                            <use xlink:href="{% static 'svg/sprites.svg' %}#it-delete"></use>
                        </svg>
                    </button>
                    <div class="it-example-modal text-start">
                       <div class="modal" tabindex="-1" role="dialog" id="delete" aria-labelledby="actionTitle">
                          <div class="modal-dialog" role="document">
                             <div class="modal-content">
                                <div class="modal-header">
                                   <h2 class="modal-title h5" id="actionTitle">{% trans "Confirm" %}</h2>
                                   <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Chiudi finestra modale">
                                      <svg class="icon"><use href="{% static 'svg/sprites.svg' %}#it-close"></use></svg>
                                   </button>
                                </div>
                                <div class="modal-body">
                                   <p>{% trans "Are you sure you want to delete the request?" %}</p>
                                </div>
                                <form method="post" action="{% url 'applications:application_required_delete' application_pk=application.pk insertion_pk=insertion.pk %}">
                                    <div class="modal-footer">
                                       <input class="btn btn-danger"
                                               type="submit"
                                               id="submitForm"
                                               value="{% trans 'Yes, proceed' %}">
                                    </div>
                                    {% csrf_token %}
                                </form>
                             </div>
                          </div>
                       </div>
                    </div>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info my-3" role="alert">
    {% trans "No items here" %}
</div>
{% endif %}

{% if application.is_editable %}
<div class="d-grid gap-2 mt-4">
    <a href="{% url 'applications:application_required_new' application_pk=application.pk teaching_id=target_teaching.id %}" class="btn btn-success">
        {% trans "Add new recognition request" %}
    </a>
</div>
{% endif %}

{% endblock clean_content %}
